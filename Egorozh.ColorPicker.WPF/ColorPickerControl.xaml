<UserControl x:Class="Egorozh.ColorPicker.ColorPickerControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 

             xmlns:local="clr-namespace:Egorozh.ColorPicker"
             xmlns:forms="clr-namespace:AKIM.ColorPicker.Forms"
             mc:Ignorable="d" 
             
             x:Name="ColorPicker">

    <UserControl.Resources>
        <Style TargetType="{x:Type Button}">

            <Setter Property="Padding" Value="2" />
            <Setter Property="SnapsToDevicePixels" Value="True" />

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Grid>

                            <Border x:Name="Border"
                                    Background="Transparent"
                                    BorderBrush="Transparent"
                                    BorderThickness="1"
                                    SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />

                            <ContentControl Name="PART_ContentPresenter"
                                            ContentTemplate="{TemplateBinding ContentTemplate}"
                                            Content="{TemplateBinding Content}"
                                            ContentTemplateSelector="{TemplateBinding ContentTemplateSelector}"
                                            ContentStringFormat="{TemplateBinding ContentStringFormat}"
                                            HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            Margin="{TemplateBinding Padding}"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                            VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" TargetName="Border"
                                        Value="DarkGray" />
                                <Setter Property="BorderBrush" TargetName="Border"
                                        Value="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" TargetName="Border"
                                        Value="Gray" />
                                <Setter Property="BorderBrush" TargetName="Border"
                                        Value="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <DrawingGroup x:Key="TransparencyTile">
            <GeometryDrawing Brush="White">
                <GeometryDrawing.Geometry>
                    <RectangleGeometry Rect="0,0,100,100" />
                </GeometryDrawing.Geometry>
            </GeometryDrawing>

            <GeometryDrawing Brush="#d7d7d7">
                <GeometryDrawing.Geometry>
                    <GeometryGroup>
                        <RectangleGeometry Rect="0,0,50,50" />
                        <RectangleGeometry Rect="50,50,50,50" />
                    </GeometryGroup>
                </GeometryDrawing.Geometry>
            </GeometryDrawing>
        </DrawingGroup>

        <DrawingImage x:Key="DropperDrawingImage">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V512 H512 V0 H0 Z">
                    <DrawingGroup.Transform>
                        <TranslateTransform X="0" Y="0.00044860827620141208" />
                    </DrawingGroup.Transform>
                    <GeometryDrawing Brush="#FF78B9EB"
                                     Geometry="F1 M512,512z M0,0z M377.404,164.878L283.082,259.2 203.253,339.029C189.856,352.416,170.94,357.1,153.661,353.115L125.292,381.484C119.46,387.316 111.78,390.228 104.101,390.228 96.422,390.228 88.742,387.317 82.91,381.484 71.245,369.829 71.245,350.756 82.91,339.102L111.279,310.722C107.283,293.454,111.968,274.527,125.365,261.141L205.194,181.312 299.516,86.98C304.785,81.721,313.403,81.721,318.672,86.98L377.404,145.722C382.673,150.991,382.673,159.609,377.404,164.878z" />
                    <GeometryDrawing Brush="#FFC2DFF6"
                                     Geometry="F1 M512,512z M0,0z M377.404,164.878L283.082,259.2 205.194,181.312 299.516,86.98C304.785,81.721,313.403,81.721,318.672,86.98L377.404,145.722C382.673,150.991,382.673,159.609,377.404,164.878z" />
                    <GeometryDrawing Brush="#FF5AAAE7"
                                     Geometry="F1 M512,512z M0,0z M105.458,500.439C100.032,507.044 92.009,511.53 82.504,511.968 81.982,511.99 81.46,512 80.928,512L79.676,512C79.154,512 78.633,511.99 78.111,511.969 55.543,510.946 41.342,487.043 50.357,466.332L73.906,412.212C76.337,406.62,84.277,406.62,86.708,412.212L91.894,424.138 110.257,466.332C115.474,478.32,112.917,491.362,105.458,500.439z" />
                    <GeometryDrawing Brush="#FF78B9EB"
                                     Geometry="F1 M512,512z M0,0z M105.458,500.439C83.37,498.884,69.628,475.314,78.528,454.854L91.894,424.137 110.257,466.331C115.474,478.32,112.917,491.362,105.458,500.439z" />
                    <GeometryDrawing Brush="#FF5AAAE7"
                                     Geometry="F1 M512,512z M0,0z M346.208,114.514C340.929,109.37,332.394,109.412,327.166,114.629L232.844,208.961 153.015,288.79C139.618,302.177,134.933,321.103,138.929,338.371L110.56,366.751C104.175,373.136 101.284,381.744 101.89,390.144 94.962,389.643 88.18,386.753 82.911,381.484 71.246,369.829 71.246,350.756 82.911,339.102L111.28,310.722C107.284,293.454,111.969,274.527,125.366,261.141L205.195,181.312 299.517,86.98C304.786,81.721,313.404,81.721,318.673,86.98L346.208,114.514z" />
                    <GeometryDrawing Brush="#FFB3D8F4"
                                     Geometry="F1 M512,512z M0,0z M346.208,114.514C340.929,109.37,332.394,109.412,327.166,114.629L232.844,208.961 205.194,181.311 299.516,86.979C304.785,81.72,313.403,81.72,318.672,86.979L346.208,114.514z" />
                    <GeometryDrawing Brush="#FF2D2D30"
                                     Geometry="F1 M512,512z M0,0z M445.442,114.305L435.102,124.655 387.086,172.661C382.224,177.534,374.252,177.534,369.38,172.661L291.721,95.002C286.859,90.129,286.859,82.168,291.721,77.296L350.077,18.94C369.244,-0.227000000000011 397.686,-4.84900000000001 421.319,5.08399999999999 428.821,8.23499999999999 435.843,12.857 441.936,18.94L445.442,22.456C470.704,47.717,470.704,89.045,445.442,114.305z" />
                    <DrawingGroup Opacity="1">
                        <GeometryDrawing Brush="#FF3E3D42"
                                         Geometry="F1 M512,512z M0,0z M445.442,114.305L435.102,124.655 377.278,66.831C372.416,61.958,372.416,53.997,377.278,49.125L421.319,5.084C428.821,8.235,435.843,12.857,441.936,18.94L445.442,22.456C470.704,47.717,470.704,89.045,445.442,114.305z" />
                        <GeometryDrawing Brush="#FF3E3D42"
                                         Geometry="F1 M512,512z M0,0z M429.625,197.995L411.449,216.181C404.208,223.422,392.397,223.485,385.083,216.369L271.334,102.63C271.271,102.567,271.209,102.505,271.146,102.432L248.213,79.499C240.909,72.195,240.909,60.249,248.213,52.945L266.399,34.759C273.703,27.455,285.649,27.455,292.953,34.759L316.085,57.891 429.625,171.43C436.928,178.734,436.928,190.691,429.625,197.995z" />
                    </DrawingGroup>
                    <GeometryDrawing Brush="#FF57565C"
                                     Geometry="F1 M512,512z M0,0z M429.625,197.995L411.449,216.181C404.208,223.422,392.397,223.485,385.083,216.369L271.334,102.63C271.271,102.567 271.209,102.505 271.146,102.432 264.03,95.118 264.093,83.307 271.334,76.066L289.52,57.89C296.824,50.586,308.781,50.586,316.084,57.89L429.625,171.43C436.928,178.734,436.928,190.691,429.625,197.995z" />
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>

        <DrawingBrush x:Key="TransparencyBrush"
                      TileMode="Tile"
                      Viewport="0 0 10 10"
                      ViewportUnits="Absolute"
                      Drawing="{StaticResource TransparencyTile}" />

        <Cursor x:Key="EyedropperCursor">/Egorozh.ColorPicker.WPF;component/Resources/eyedropper.cur</Cursor>

    </UserControl.Resources>

    <StackPanel>

        <Grid>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Margin="6">
                <WindowsFormsHost>
                    <forms:ColorWheel x:Name="ColorWheel" />
                </WindowsFormsHost>

                <StackPanel Orientation="Horizontal"
                            Margin="0 4">

                    <Button Width="24" Height="24"
                            Margin="0 2 2 2"
                            ToolTip="Load Palette"
                            Click="LoadBtnClick">
                        <Image>
                            <Image.Source>
                                <DrawingImage>
                                    <DrawingImage.Drawing>
                                        <DrawingGroup>

                                            <GeometryDrawing Brush="SandyBrown">
                                                <GeometryDrawing.Geometry>
                                                    <CombinedGeometry GeometryCombineMode="Xor">
                                                        <CombinedGeometry.Geometry1>
                                                            <GeometryGroup>
                                                                <PathGeometry>M2.608788263309883,-18.217298732119513A1.5734851149009803,1.5734851149009803,0,1,1,5.740358436643893,-18.330075535789415A1.5735527482605192,1.5735527482605192,0,0,1,2.6128160062980945,-18.184069852466774z</PathGeometry>
                                                                <PathGeometry>M6.118151464840222,-21.616117978040943A1.5734851149009803,1.5734851149009803,0,1,1,9.249721638174233,-21.728894781710846A1.5735527482605192,1.5735527482605192,0,0,1,6.122179207828434,-21.582889098388204z</PathGeometry>
                                                            </GeometryGroup>
                                                        </CombinedGeometry.Geometry1>
                                                        <CombinedGeometry.Geometry2>
                                                            <PathGeometry>M3.6187448176037655,-12.15453859911499L3.448572676351854,-14.169417028967512A1.328615809605339,1.328615809605339,0,0,1,4.439397451451747,-15.337462495548689L19.337011829096983,-15.348538788766266A2.4203486858570127,2.4203486858570127,0,0,0,17.74202560576545,-17.998793675009065L15.547912612937541,-19.07722186010255A1.7469853367783947,1.7469853367783947,0,0,1,14.6134762396726,-20.18082343887235A0.42130719727126675,0.42130719727126675,0,0,1,14.839029847012412,-20.81720683100968A2.998527385014755,2.998527385014755,0,0,1,16.720992758253974,-20.57654918746407A0.8751686915254184,0.8751686915254184,0,0,0,17.855809345182404,-21.154530306272346A2.015507632105159,2.015507632105159,0,0,0,17.39765358027341,-22.64177440466923A10.045673837983784,10.045673837983784,0,0,0,10.210146217810983,-25.520603705493006A10.119655671225049,10.119655671225049,0,0,0,1.1416828798540348,-20.2372118407073A7.430396980576169,7.430396980576169,0,0,0,3.799993252073257,-10.54142753233651z</PathGeometry>
                                                        </CombinedGeometry.Geometry2>
                                                    </CombinedGeometry>
                                                </GeometryDrawing.Geometry>
                                            </GeometryDrawing>

                                            <GeometryDrawing Brush="Orange"
                                                             Geometry="M5.650741155156241,-0.47005619031504153A0.40044558211225123,0.40044558211225123,0,0,1,5.3436257523051545,-0.7882478863837044L4.309502740081955,-14.213722201837843A0.2714957255010366,0.2714957255010366,0,0,1,4.556201998109875,-14.516809861700718L28.485023091071096,-14.526879219171239A0.2956328119954868,0.2956328119954868,0,0,1,28.708562826916804,-14.194590422643838L27.66940513595841,-0.7932825651189823A0.4720716746116193,0.4720716746116193,0,0,1,27.359268925866168,-0.4620007043386316L5.952821879272061,-0.4720700618091449z" />

                                            <GeometryDrawing Brush="Orange"
                                                             Geometry="M20.526202946366308,-17.88702380708622L26.281847676519746,-17.892058485821483A0.39418820033344126,0.39418820033344126,0,0,1,26.692677461317263,-17.58595001871745L26.90312703245128,-15.19649149096131 20.098255253868892,-15.205553912684788A3.1316368696616514,3.1316368696616514,0,0,0,19.338018764844076,-17.889037678580333z" />


                                        </DrawingGroup>
                                    </DrawingImage.Drawing>
                                </DrawingImage>
                            </Image.Source>

                        </Image>
                    </Button>

                    <Button Width="24" Height="24"
                            Margin="0 2"
                            ToolTip="Save Palette"
                            Click="SavePalleteBtnClick">
                        <Image>
                            <Image.Source>
                                <DrawingImage>
                                    <DrawingImage.Drawing>
                                        <DrawingGroup>
                                            <GeometryDrawing Brush="SandyBrown">
                                                <GeometryDrawing.Geometry>
                                                    <CombinedGeometry GeometryCombineMode="Xor">
                                                        <CombinedGeometry.Geometry1>
                                                            <GeometryGroup>
                                                                <PathGeometry>M6.289630631881872,-21.863440093978287A1.2996579238563724,1.2996579238563724,0,0,1,8.888148835097455,-21.914865948989526A1.2994732534729319,1.2994732534729319,0,1,1,6.290638981980134,-21.829156190637445z</PathGeometry>
                                                                <PathGeometry>M3.372534425020115,-19.04130745515425A1.2996579238563724,1.2996579238563724,0,0,1,5.971052628235698,-19.09273331016549A1.2994732534729319,1.2994732534729319,0,1,1,3.373542775118376,-19.007023551813408z</PathGeometry>
                                                                <PathGeometry>M4.219548507558373,-15.048241066045318A1.2996579238563724,1.2996579238563724,0,0,1,6.818066710773957,-15.099666921056556A1.2994732534729319,1.2994732534729319,0,1,1,4.220556857656634,-15.013957162704475z</PathGeometry>
                                                            </GeometryGroup>
                                                        </CombinedGeometry.Geometry1>
                                                        <CombinedGeometry.Geometry2>
                                                            <PathGeometry>M7.559143405591012,-18.14666163179253A2.5790776042707506,2.5790776042707506,0,0,1,7.98567549715492,-19.34458154852521A1.2087275203484567,1.2087275203484567,0,0,1,8.980917044137371,-19.83363134618124L13.766546610478532,-19.861865148932505A1.1860115612694033,1.1860115612694033,0,0,1,13.330787320874586,-20.536928841923366A0.34935035023687405,0.34935035023687405,0,0,1,13.517817668876482,-21.064621609500147A2.486396147358601,2.486396147358601,0,0,1,15.078352135017301,-20.865066907837406A0.7256949106993211,0.7256949106993211,0,0,0,16.019348573401828,-21.344332174592264A1.671270516481879,1.671270516481879,0,0,0,15.639443179022978,-22.577563531729762A8.329930502955854,8.329930502955854,0,0,0,9.679520750284013,-24.9647053394861A8.61786761524652,8.61786761524652,0,0,0,2.1311948266583394,-20.662495126950798A5.758744075848849,5.758744075848849,0,0,0,2.0505268187975556,-15.132703188093895A7.35655079639427,7.35655079639427,0,0,0,7.513767651169319,-11.257613760481364z</PathGeometry>
                                                        </CombinedGeometry.Geometry2>
                                                    </CombinedGeometry>
                                                </GeometryDrawing.Geometry>
                                            </GeometryDrawing>

                                            <GeometryDrawing Brush="DodgerBlue">
                                                <GeometryDrawing.Geometry>
                                                    <CombinedGeometry GeometryCombineMode="Xor">
                                                        <CombinedGeometry.Geometry1>
                                                            <GeometryGroup>
                                                                <PathGeometry>M8.328514530563291,-8.635903505005782L8.307339178499841,-18.13153638031861A1.2773187320474797,1.2773187320474797,0,0,1,9.275355272829279,-19.099552474648046L22.523058863766927,-19.109635975630635 26.50100000140195,-15.118586286718223 26.49999165130368,-1.9969264580630366A1.2643346818139622,1.2643346818139622,0,0,1,25.4250904465587,-0.9210169032197912L9.481058692874258,-0.9190002030232725A1.2291456284760196,1.2291456284760196,0,0,1,8.311372578892856,-1.9999515083578112z</PathGeometry>
                                                                <PathGeometry>M19.279196597665035,-15.723596345674114L19.276171547370254,-16.36793205846215A0.2515980307546297,0.2515980307546297,0,0,1,19.48187496741526,-16.61598618263407L21.460257860201047,-16.646236685581858A0.2558944811548716,0.2558944811548716,0,0,1,21.693186732899072,-16.41028276258906L21.697220133292113,-12.497884381340919A0.3034020721558491,0.3034020721558491,0,0,1,21.50361691442623,-12.255880357758562L19.486916717906567,-12.272013959330716A0.26734816517403065,0.26734816517403065,0,0,1,19.27314649707548,-12.54225178566435z</PathGeometry>
                                                                <PathGeometry>M13.428749327561505,-9.29838951956247L22.66785960184273,-9.29838951956247A0.4451311450259195,0.4451311450259195,0,0,1,22.66785960184273,-8.409747362548998L12.07050086504254,-8.409747362549002A0.459121925270507,0.459121925270507,0,0,1,12.07050086504254,-9.291414117864473z</PathGeometry>
                                                                <PathGeometry>M13.418499163245219,-6.6460675700602785L22.657609437526446,-6.6460675700602785A0.4451311450259195,0.4451311450259195,0,0,1,22.657609437526446,-5.757425413046806L12.060250700726254,-5.757425413046809A0.459121925270507,0.459121925270507,0,0,1,12.060250700726254,-6.639092168362282z</PathGeometry>
                                                                <PathGeometry>M13.418499163245219,-4.024357314584718L22.657609437526446,-4.024357314584718A0.4451311450259195,0.4451311450259195,0,0,1,22.657609437526446,-3.135715157571246L12.060250700726254,-3.135715157571248A0.459121925270507,0.459121925270507,0,0,1,12.060250700726254,-4.01738191288672z</PathGeometry>
                                                            </GeometryGroup>
                                                        </CombinedGeometry.Geometry1>
                                                        <CombinedGeometry.Geometry2>
                                                            <GeometryGroup>
                                                                <PathGeometry>M12.165286654441932,-17.409557709964535L22.9598115088125,-17.400482559080206A0.3369927124816186,0.3369927124816186,0,0,1,23.30251348972177,-17.002184270267566L23.30251348972177,-11.930093066575479A0.37886548640054674,0.37886548640054674,0,0,1,22.97984145827862,-11.486509232786288L11.807031153110048,-11.486509232786291A0.3106282461472871,0.3106282461472871,0,0,1,11.514900841064343,-11.789014262264237L11.514900841064343,-17.093022044102245A0.2911871623207035,0.2911871623207035,0,0,1,11.721612611207606,-17.401490909178452z</PathGeometry>
                                                                <PathGeometry>M11.528009392341707,-10.75444706144966L24.190893051353413,-10.75444706144966A0.28212595386579054,0.28212595386579054,0,0,1,24.408673547512784,-10.542693540815094L24.408673547512784,-1.9705996962090104A0.2682310878402524,0.2682310878402524,0,0,1,24.161627773439115,-1.6561041248512085L10.659819618862068,-1.6561041248512103A0.30542231438271134,0.30542231438271134,0,0,1,10.369415129441158,-1.9495340034448239L10.369415129441158,-10.4217320933559A0.3605286909226508,0.3605286909226508,0,0,1,10.609402452827002,-10.754447061449664z</PathGeometry>
                                                            </GeometryGroup>
                                                        </CombinedGeometry.Geometry2>
                                                    </CombinedGeometry>
                                                </GeometryDrawing.Geometry>
                                            </GeometryDrawing>

                                        </DrawingGroup>
                                    </DrawingImage.Drawing>
                                </DrawingImage>
                            </Image.Source>
                        </Image>
                    </Button>

                </StackPanel>

                <WindowsFormsHost>
                    <forms:ColorGrid x:Name="ColorGrid" />
                </WindowsFormsHost>
            </StackPanel>

            <StackPanel Grid.Column="1"
                        Margin="0 6 6 6">

                <local:ColorEditorPort x:Name="ColorEditor" />

            </StackPanel>

            <Grid Grid.Column="2"
                  Margin="0 6">

                <Grid VerticalAlignment="Center"
                      Width="85"
                      Height="85">

                    <local:ScreenColorPickerPort x:Name="ScreenColorPickerPort" 
                                                ToolTip="Click and drag to select screen color">
                        <local:ScreenColorPickerPort.InitImage>
                            <Image Source="{StaticResource DropperDrawingImage}" />
                        </local:ScreenColorPickerPort.InitImage>
                    </local:ScreenColorPickerPort>

                </Grid>

                <Border VerticalAlignment="Bottom"
                        Height="30"
                        Margin="0 20"
                        BorderThickness="1"
                        BorderBrush="{Binding ElementName=ColorPicker, Path=Foreground}">

                    <Grid Background="{StaticResource TransparencyBrush}">
                        <Border x:Name="PreviewPanel" />
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </StackPanel>

</UserControl>
